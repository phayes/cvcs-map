<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
  <head>
    <meta charset=utf-8 />
    <title>Comox Valley Sensitive Ecosystem Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <meta property="og:image" content="fb-preview.png" />
    <script src='//code.jquery.com/jquery-2.1.1.min.js'></script>
    <script src='//api.tiles.mapbox.com/mapbox.js/v2.1.2/mapbox.js'></script>
    <link href='//api.tiles.mapbox.com/mapbox.js/v2.1.2/mapbox.css' rel='stylesheet' />
    <script src="//maps.google.com/maps/api/js?v=3.2&amp;sensor=false"></script>
    <link href='cvcs-map.css' rel='stylesheet' />
    <style>
      body { margin:0; padding:0; }
      #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
  </head>
  <body>
    <img src="fb-preview.png" id="fb-preview-image" />
    <div id='map'></div>
    <div id='legend'>
      <h4 class='legend-desc'>Comox Valley Sensitive Ecosystem Inventory</h4>

      <div id='sei-legend'>
        <div id='sei-desc' class='legend-desc'>
          <p>
            This map shows sensitive ecosystems in the Comox Valley on Vancouver Island. Hover over a shape on the map to see what type of ecosystem it is, and what state it is in.
          </p>
          <p>
            To learn more visit <a target='_blank' href='http://www.cvconservationstrategy.org'>www.cvconservationstrategy.org</a>
          </p>
        </div>
        <div id='protected' class='legend-line'>
          <span id='protected-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Park / Protected</span>
        </div>
        <div id='intact-sei' class='legend-line'> 
          <span id='intact-sei-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Sensitive Ecosystem - Intact</span>
        </div>
        <div id='degraded-sei' class='legend-line'>
          <span id='degraded-sei-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Sensitive Ecosystem - Degraded</span>
        </div>
        <div id='lost-sei' class='legend-line'>
          <span id='lost-sei-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Sensitive Ecosystem - Lost</span>
        </div>
      </div>

      <div id='fc-legend'>
        <div id='fc-desc' class='legend-desc'>
          <p>
            Results from time-series analysis of 654,178 Landsat images in characterizing forest extent and change, 2000–2013. Published by Hansen, Potapov, Moore, Hancher et al.
          </p>
            <a target='_blank' href='http://earthenginepartners.appspot.com/science-2013-global-forest'>
              earthenginepartners.appspot.com/science-2013-global-forest
            </a>
        </div>
        <div id='fc-loss' class='legend-line'>
          <span id='fc-loss-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Forest Loss 2000–2013</span>
        </div>
        <div id='fc-gain' class='legend-line'>
          <span id='fc-gain-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Forest Gain 2000–2012</span>
        </div>
        <div id='fc-both' class='legend-line'>
          <span id='fc-both-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Forest - Both Loss and Gain</span>
        </div>
        <div id='fc-both' class='legend-line'>
          <span id='fc-extent-colourball' class='colourball'>&#9679;</span><span class='legend-text'>Forest - No Change</span>
        </div>
      </div>

      <div id='fc-switcher'>
        <input type="checkbox" id="fc-check"/>
        <label for="fc-check">View forest change 2000 - 2014</label>
      </div>
    </div>

    <div id="mapintro">
      <img src="close.png" id='mapintro-close'/>
      <img id="mapintro-logo" src="http://www.cvconservationstrategy.org/wp-content/themes/CVCS-Child-Theme/images/logo2-opt.png" />

      <p>The Sensitive Ecosystems of the lowland Comox Valley have been heavily impacted by human activities. </p>

      <p>This map provides updated information on the Sensitive Ecosystems that were first mapped in the early 1990s by the provincial and federal governments. Human impacts have reduced the amount of intact, undisturbed sensitive ecosystems from 18% to only 5% of the lowland Comox Valley land base since 1992. Hover over a sensitive ecosystem on the map to see what type of ecosystem it is, and what state it is in, based on the 2012 disturbance assessment.</p>

      <p>Sensitive Ecosystems need to be protected and restored. Only 11% of these ecosystems are currently protected. Hover over the green areas on the map to discover which of the Sensitive Ecosystems are protected as park or conservancy land. </p>

      <p>After viewing the map we invite you to take action by contacting your local elected representative and asking them to protect sensitive ecosystems</p>

      <div id="mapintro-done">Show me the map</div>
    </div>

    <div id='sendmail'>
      <img src="close.png" id='sendmail-close'/>
      <iframe src="http://50.7.48.242/phayes/cvcs-map/sendmail.php" scrolling="no"></iframe>
    </div>
    <div id='sendmail-select'>
      <p>Seen enough?</p>
      <h4>Contact your elected representatives about protecting Sensitive Ecosystems</h4>
    </div>
    <script>
      L.mapbox.accessToken = 'pk.eyJ1IjoicGhheWVzIiwiYSI6InNHMlkzQUkifQ.C9wmsbr-8tAtViMNb1wEcA';
      var map = L.mapbox.map('map', 'phayes.jjf0jnd4');

      //var googleLayer = new L.Google('TERRAIN');
      //map.addLayer(googleLayer, true);

      var sei_layer   = L.mapbox.tileLayer('phayes.CVCS_SEI').addTo(map);
      var pro_layer   = L.mapbox.tileLayer('phayes.CVCS').addTo(map);

      var sei_grid    = L.mapbox.gridLayer('phayes.CVCS_SEI').addTo(map);
      var pro_grid    = L.mapbox.gridLayer('phayes.CVCS').addTo(map);

      var sei_control = L.mapbox.gridControl(sei_grid).addTo(map);
      var pro_control = L.mapbox.gridControl(pro_grid).addTo(map);

      // Forest Loss map
      var fl_layer = L.tileLayer('https://earthengine.google.org/static/hansen_2014/loss_tree_gain/{z}/{x}/{y}.png');

      // Scale bar
      L.control.scale().addTo(map);

      // Legend interactions
      (function ($) {
        $(document).ready(function() {
          $('#fc-check').change(function() {
            if ($(this).is(':checked')) {
              $('#sei-legend').hide();
              $('#fc-legend').show();
              
              map.addLayer(fl_layer);
              map.removeLayer(sei_layer);
              map.removeLayer(sei_grid);
              
              // Zoom out if we're too far zoomed in
              if (map.getZoom() > 12) {
                map.setZoom(12);
              }
            }
            else {
              $('#sei-legend').show();
              $('#fc-legend').hide();

              // Remove parks layers so they end-up on top when we re-add them
              map.removeLayer(pro_layer);
              map.removeLayer(pro_grid);

              map.addLayer(sei_layer);
              map.addLayer(pro_layer);
              map.addLayer(sei_grid);
              map.addLayer(pro_grid);
              map.removeLayer(fl_layer);
            }
          })

          // Tooltips for types
          var intactText = "<h5>Sensitive Ecosystem - Intact</h5> No human disturbance is observable at the assessment scale. The ecosystem is viable i.e. its native components are relatively undamaged and as such, it is expected to persist intact or follow natural successional processes over time.";
          var degradedText = "<h5>Sensitive Ecosystem - Degraded</h5> Human activities have caused disturbance but the ecosystem is still considered to be viable.";
          var lostText = "<h5>Sensitive Ecosystem - Lost</h5> Human activities have caused disturbance to the extent that the ecosystem is no longer viable (the ecosystem is so small or has so much disturbance that it would not be expected to persist over time).";

          var $controlTip = $('.leaflet-control-grid.map-tooltip.leaflet-control').first();

          $('#intact-sei').hover(function() {
            $controlTip.html("<div class='legend-sei-desc'>" + intactText + "</div>").show();
          }, function() {
            $controlTip.hide();
          });

          $('#degraded-sei').hover(function() {
            $controlTip.html("<div class='legend-sei-desc'>" + degradedText + "</div>").show();
          }, function() {
            $controlTip.hide();
          });

          $('#lost-sei').hover(function() {
            $controlTip.html("<div class='legend-sei-desc'>" + lostText + "</div>").show();
          }, function() {
            $controlTip.hide();
          });
        });
      })(jQuery);

      // Sendmail interactions
      (function ($) {
        $(document).ready(function() {
          $('#sendmail-close').click(function() {
            $('#sendmail').hide();
            $('#sendmail-select').show();
          });
          $('#sendmail-select').click(function() {
            $('#sendmail').show();
            $('#sendmail-select').hide();
          });
          $('#mapintro-close, #mapintro-done').click(function() {
            $('#mapintro').hide();
            $('#sendmail-select').show();
            $('#legend').show();
          });
          map.on('click', function() {
            $('#sendmail').hide();
            $('#mapintro').hide();
            $('#sendmail-select').show();
            $('#legend').show();
          });
        });
      })(jQuery);
    </script>
  </body>
</html>



